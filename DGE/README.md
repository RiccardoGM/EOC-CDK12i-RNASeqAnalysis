## DGE analysis

This folder contains scripts to perform *DGE analysis* and *GO term enrichment analysis* using DESeq2 and clusterProfiler.  

The analysis is run via the DGE_analysis.R script, which reads count data, metadata, and configuration files, then generates results and figures.


### Folder Structure

- gene_counts/  
  Place your count data .txt files here.  
  - Rows: genes  
  - Columns: conditions or replicates  
  - Example file provided: LINENAME_counts_matrix.txt  

- metadata/  
  Place your \<line name\>_metadata.csv files here.  
  - Required columns:  
    - name: sample names corresponding to columns in count matrix  
    - baseline: baseline state of the cell models
    - treatment: untreated or treated conditions  
  - Rows must match the columns in the count file  
  - Example file provided: LINENAME_metadata.csv  

- scripts/  
  Contains two key configuration files:  
  - parameters.json – specifies paths to folders/files, single-factor design for DGE, and GO terms for running enrichment score plots  
  - contrasts.json – specifies contrasts to analyze in the format:  
    ["factor_name", "level_to_compare", "base_level"]
    - factor_name must match the design in parameters.json  
    - Levels must be consistent with the metadata  
  - Example files are provided  

- results/  
  Empty folder. Will store results generated by the analysis, including GO terms grouped into categories.  

- figures/  
  Empty folder. Will store all generated plots, including:  
  - PCA plots  
  - LFC vs gene length plots  
  - Running enrichment score plots  
  - Grouped GO term NES plots  


### Accepted Designs

You can define *one design option* in parameters.json:

1. Single-factor designs:  
   - "baseline" – uses baseline values
   - "treatment" – uses treatment values  

2. Combined design:  
   - ["baseline", "treatment"] – a single factor is constructed by combining baseline and treatment values.  
     Example:  
     baseline levels: State1, State2
     treatment levels: U, A, B
     resulting combined levels: State1U, State1A, State1B, State2U, State2A, State2B 

> Only one of these options can be used as the single-factor design.


### How to Run

Run the main script: DGE_analysis.R

The script will:

1. Load count data and metadata

2. Filter lowly expressed genes

3. Perform DGE analysis using DESeq2

4. Generate PCA plots

5. Plot LFC vs gene length

6. Run GO term enrichment analysis using clusterProfiler

7. Save all results and figures to the folders specified in parameters.json

### Important Notes

**Make sure metadata rows exactly match count matrix columns.**

Contrasts in contrasts.json must be consistent with the design and metadata.

Example files (LINENAME_counts_matrix.txt, LINENAME_metadata.csv, contrasts.json) are provided to guide formatting.

The results/ and figures/ folders will contain the analysis output only if their paths are correctly specified in parameters.json